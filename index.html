<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>講道準備檢核表</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --border-color: #ddd;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 15px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 20px 15px;
            background: linear-gradient(135deg, var(--primary-color) 0%, #1a2530 100%);
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            line-height: 1.3;
        }
        
        .header .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .scripture {
            font-style: italic;
            color: #f1c40f;
            margin: 10px 0;
            font-size: 0.95rem;
        }
        
        .info-section {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-group input:focus, .form-group textarea:focus {
            border-color: var(--secondary-color);
            outline: none;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .phase-container {
            margin-bottom: 20px;
        }
        
        .phase-header {
            background-color: var(--primary-color);
            color: white;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
            box-shadow: var(--shadow);
            position: relative;
            user-select: none;
        }
        
        .phase-header:hover {
            background-color: #34495e;
        }
        
        .phase-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
        }
        
        .phase-header .toggle-icon {
            transition: transform 0.3s;
        }
        
        .phase-header.active .toggle-icon {
            transform: rotate(180deg);
        }
        
        .phase-content {
            background-color: white;
            padding: 0;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.5s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .phase-content.active {
            max-height: 5000px;
            padding: 20px;
        }
        
        .check-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .check-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .check-question {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-color);
            line-height: 1.5;
            font-size: 1.05rem;
        }
        
        .check-question .verse {
            color: var(--accent-color);
            font-size: 0.9rem;
            font-weight: normal;
            font-style: italic;
            display: inline-block;
            margin-left: 5px;
        }
        
        .notes-area {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
            background-color: #f9f9f9;
        }
        
        .notes-area:focus {
            border-color: var(--secondary-color);
            outline: none;
            background-color: white;
        }
        
        /* 階段三和階段四的checkbox樣式 */
        .checkbox-container {
            margin-bottom: 15px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .checkbox-item:nth-child(odd) {
            border-left-color: #2ecc71;
        }
        
        .checkbox-item:nth-child(even) {
            border-left-color: #9b59b6;
        }
        
        .checkbox-item input[type="checkbox"] {
            margin-right: 12px;
            margin-top: 4px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-label {
            flex: 1;
            font-weight: 500;
            line-height: 1.5;
            cursor: pointer;
        }
        
        .phase-notes-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #ddd;
        }
        
        .phase-notes-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        
        .phase-notes-area {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            background-color: #f9f9f9;
            resize: vertical;
        }
        
        .phase-notes-area:focus {
            border-color: var(--secondary-color);
            outline: none;
            background-color: white;
        }
        
        .prayer-section {
            background-color: #e8f4fc;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--secondary-color);
        }
        
        .prayer-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .prayer-text {
            font-style: italic;
            line-height: 1.7;
            color: #2c3e50;
            background-color: rgba(255,255,255,0.7);
            padding: 20px;
            border-radius: 6px;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .save-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            min-width: 200px;
            transition: background-color 0.3s;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .save-btn:hover {
            background-color: #219653;
        }
        
        .export-btn {
            background-color: #2980b9;
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            min-width: 200px;
            transition: background-color 0.3s;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .export-btn:hover {
            background-color: #1c6ea4;
        }
        
        .reset-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            cursor: pointer;
            display: inline-block;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        .reset-btn:hover {
            background-color: #c0392b;
        }
        
        .completion-status {
            font-size: 0.9rem;
            color: #7f8c8d;
            text-align: right;
            margin-bottom: 10px;
        }
        
        .save-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #27ae60;
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .save-notification.show {
            opacity: 1;
        }
        
        .auto-save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(52, 152, 219, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 1000;
        }
        
        .auto-save-indicator.show {
            display: flex;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .phase-header h2 {
                font-size: 1.2rem;
            }
            
            .check-question {
                font-size: 1rem;
            }
            
            .prayer-section {
                padding: 20px 15px;
            }
            
            .button-container {
                flex-direction: column;
            }
            
            .save-btn, .export-btn {
                width: 100%;
                min-width: unset;
            }
        }
        
        /* 打印樣式 */
        @media print {
            .phase-header {
                background-color: #f1f1f1 !important;
                color: black !important;
                border: 1px solid #ccc;
            }
            
            .phase-content {
                max-height: none !important;
                display: block !important;
                padding: 20px !important;
            }
            
            .save-btn, .export-btn, .reset-btn, .footer, .auto-save-indicator, .save-notification {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>講道準備檢核表</h1>
        <div class="scripture">「按著正意分解真理的道」（提後2:15）</div>
    </div>
    
    <div class="info-section">
        <div class="form-group">
            <label for="sermonTopic">講道主題/經文：</label>
            <input type="text" id="sermonTopic" placeholder="例如：從浪子回頭看神的恩典（路15:11-32）">
        </div>
        <div class="form-group">
            <label for="targetAudience">目標會眾：</label>
            <input type="text" id="targetAudience" placeholder="北宣主日" value="北宣主日">
        </div>
        <div class="form-group">
            <label for="coreTruth">核心真理（一段話）：</label>
            <textarea id="coreTruth" placeholder="例如：神就像故事中的父親，時刻等待我們回轉。無論我們曾經遠離祂多遠，只要願意回頭，祂都張開雙臂迎接，用無條件的愛恢復我們兒女的身份。"></textarea>
        </div>
        <div class="form-group">
            <label for="preacherName">講員姓名：</label>
            <input type="text" id="preacherName" placeholder="請填寫講員姓名">
        </div>
        <div class="form-group">
            <label for="sermonDate">講道日期：</label>
            <input type="date" id="sermonDate">
        </div>
    </div>
    
    <div class="completion-status" id="completionStatus">完成度：0%</div>
    
    <div id="checklist-container">
        <!-- 第一階段 -->
        <div class="phase-container">
            <div class="phase-header" data-phase="1">
                <h2><i class="fas fa-book"></i> 第一階段：扎根聖道——以經解經的嚴謹功夫</h2>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div class="phase-content" id="phase-1">
                <div class="check-item">
                    <div class="check-question">1. 上下文檢視：我是否仔細研讀了這段經文的文學上下文（章節脈絡）與歷史文化背景？它如何融入全書主題？</div>
                    <textarea class="notes-area" placeholder="在此記錄你的研讀筆記..."></textarea>
                </div>
                <div class="check-item">
                    <div class="check-question">2. 以經解經：針對關鍵詞或概念，我是否使用了其他經文來解釋，而非僅靠個人見解？</div>
                    <textarea class="notes-area" placeholder="記錄你找到的相關經文及其解釋..."></textarea>
                </div>
                <div class="check-item">
                    <div class="check-question">3. 基督中心：這段經文如何指向或見證基督？與福音的核心有何關聯？<span class="verse">（路24:27）</span></div>
                    <textarea class="notes-area" placeholder="思考經文與基督的關聯..."></textarea>
                </div>
                <div class="check-item">
                    <div class="check-question">4. 核心教義提煉：這段經文清晰傳達的一個主要真理是什麼？它屬於哪個基本教義範疇？</div>
                    <textarea class="notes-area" placeholder="提煉核心真理與所屬教義範疇..."></textarea>
                </div>
                <div class="check-item">
                    <div class="check-question">5. 生活處境辨認：經文揭示的人性光景、需要或問題，與當代會眾的生命處境有何共通之處？</div>
                    <textarea class="notes-area" placeholder="辨認當代生活處境與經文的關聯..."></textarea>
                </div>
            </div>
        </div>
        
        <!-- 第二階段 -->
        <div class="phase-container">
            <div class="phase-header" data-phase="2">
                <h2><i class="fas fa-brain"></i> 第二階段：建造階梯——聽眾心智的認知設計</h2>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div class="phase-content" id="phase-2">
                <div class="check-item">
                    <div class="check-question">6. 開場：從「他們的世界」開始：我的開場是否從一個會眾共鳴的故事、文化現象或普遍困惑切入？</div>
                    <textarea class="notes-area" placeholder="構思你的開場方式..."></textarea>
                </div>
                <div class="check-item">
                    <div class="check-question">7. 結構組塊化（3點為宜）：我將信息分成幾個清晰、易記的模組？</div>
                    <textarea class="notes-area" placeholder="列出你的講道結構（建議3點）..."></textarea>
                </div>
                <div class="check-item">
                    <div class="check-question">8. 漸進式啟示：每個部分是否遵循「展示經文 → 解釋真意 → 今日應用」的邏輯？</div>
                    <textarea class="notes-area" placeholder="規劃每個部分的進展邏輯..."></textarea>
                </div>
                <div class="check-item">
                    <div class="check-question">9. 認知休息點：我是否在每部分之間，設計了見證故事、簡短影音或反思問題？</div>
                    <textarea class="notes-area" placeholder="設計認知休息點..."></textarea>
                </div>
                <div class="check-item">
                    <div class="check-question">10. 強力結尾：呼召與應許：我的結尾是否清晰呼召會眾作出具體回應，並指向神的應許與恩典？</div>
                    <textarea class="notes-area" placeholder="設計結尾的呼召與應許..."></textarea>
                </div>
            </div>
        </div>
        
        <!-- 第三階段 -->
        <div class="phase-container">
            <div class="phase-header" data-phase="3">
                <h2><i class="fas fa-heart"></i> 第三階段：點燃心靈——多感官與情感的觸動</h2>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div class="phase-content" id="phase-3">
                <div class="checkbox-container">
                    <div class="checkbox-item">
                        <input type="checkbox" id="check11" class="phase3-checkbox">
                        <label for="check11" class="checkbox-label">11. 聖經比喻現代化：我是否找到一個當代類比，來闡明經文中的古老比喻或概念？</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="check12" class="phase3-checkbox">
                        <label for="check12" class="checkbox-label">12. 視覺與多媒體：我使用的視覺輔助是否能強化真理印象，而非分散注意力？</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="check13" class="phase3-checkbox">
                        <label for="check13" class="checkbox-label">13. 互動與體驗設計：我是否設計了簡單的會眾參與方式？</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="check14" class="phase3-checkbox">
                        <label for="check14" class="checkbox-label">14. 情感真實性：我分享的見證或應用，是否發自內心，並能真誠地傳遞對神恩典的敬畏、喜樂或盼望？</label>
                    </div>
                </div>
                
                <div class="phase-notes-section">
                    <label for="phase3-notes">第三階段筆記：</label>
                    <textarea id="phase3-notes" class="phase-notes-area" placeholder="記錄關於多感官與情感觸動的額外想法、具體執行細節或需要注意的事項..."></textarea>
                </div>
            </div>
        </div>
        
        <!-- 第四階段 -->
        <div class="phase-container">
            <div class="phase-header" data-phase="4">
                <h2><i class="fas fa-pray"></i> 第四階段：倚靠聖靈——內化與禱告的預備</h2>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div class="phase-content" id="phase-4">
                <div class="checkbox-container">
                    <div class="checkbox-item">
                        <input type="checkbox" id="check15" class="phase4-checkbox">
                        <label for="check15" class="checkbox-label">15. 信息已內化為生命嗎？：這篇道的信息是否先對我自己說話？我能否不看講稿，自然講述核心內容？</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="check16" class="phase4-checkbox">
                        <label for="check16" class="checkbox-label">16. 為會眾提名禱告：我是否已為具體的會眾群體和他們可能的反應禱告？</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="check17" class="phase4-checkbox">
                        <label for="check17" class="checkbox-label">17. 恩典導向：我的講道整體是傳遞「神為你成就了什麼」的福音恩典，還是僅僅停留在「你當做什麼」的道德規條？</label>
                    </div>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="check18" class="phase4-checkbox">
                        <label for="check18" class="checkbox-label">18. 聖靈空間：我是否在講章中預留了空間，讓聖靈在現場自由運行與引導？</label>
                    </div>
                </div>
                
                <div class="phase-notes-section">
                    <label for="phase4-notes">第四階段筆記：</label>
                    <textarea id="phase4-notes" class="phase-notes-area" placeholder="記錄關於內化、禱告與聖靈引導的額外想法、具體禱告事項或需要注意的事項..."></textarea>
                </div>
            </div>
        </div>
    </div>
    
    <div class="prayer-section">
        <h3>最後的禱告檢視</h3>
        <div class="prayer-text">
            「主啊，這篇道：<br><br>
            - 是否<strong>忠於你的話語</strong>？（第一階段）<br>
            - 是否<strong>顧念羊群的需要與理解</strong>？（第二、三階段）<br>
            - 是否<strong>倚靠並榮耀你的靈</strong>？（第四階段）<br><br>
            願我不是單傳遞知識，而是<strong>見證你的生命</strong>；不只建造頭腦，更是<strong>觸動心靈，喚醒意志</strong>。奉主耶穌的名求，阿們。」
        </div>
    </div>
    
    <div class="button-container">
        <button class="save-btn" id="saveButton">
            <i class="fas fa-save"></i> 保存到瀏覽器
        </button>
        <button class="export-btn" id="exportButton">
            <i class="fas fa-file-word"></i> 匯出Word文件
        </button>
    </div>
    
    <button class="reset-btn" id="resetButton">
        <i class="fas fa-redo"></i> 重置所有內容
    </button>
    
    <!-- 自動保存指示器 -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        <i class="fas fa-sync-alt fa-spin"></i>
        <span>自動保存中...</span>
    </div>
    
    <!-- 保存通知 -->
    <div class="save-notification" id="saveNotification">
        <i class="fas fa-check-circle"></i>
        <span>內容已保存！</span>
    </div>
    
    <div class="footer">
        <p>講道準備檢核表<br>
        祝你傳講得力，見證主道的大能！</p>
    </div>

    <script>
        // DOM加載完成後初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化事件監聽器
            initEventListeners();
            
            // 載入保存的數據
            loadSavedData();
            
            // 更新完成度
            updateCompletionStatus();
            
            // 顯示載入完成提示
            setTimeout(() => {
                showNotification('已載入上次保存的內容', 'info');
            }, 500);
            
            // 設置講道日期為今天
            const today = new Date();
            const todayFormatted = today.toISOString().split('T')[0];
            document.getElementById('sermonDate').value = todayFormatted;
            
            // 設置目標會眾為「北宣主日」
            document.getElementById('targetAudience').value = "北宣主日";
        });
        
        // 初始化所有事件監聽器
        function initEventListeners() {
            // 階段展開/收起事件
            const phaseHeaders = document.querySelectorAll('.phase-header');
            phaseHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const phaseNum = this.getAttribute('data-phase');
                    togglePhase(phaseNum);
                });
            });
            
            // 保存按鈕事件
            document.getElementById('saveButton').addEventListener('click', saveAllData);
            
            // 匯出按鈕事件
            document.getElementById('exportButton').addEventListener('click', exportToWord);
            
            // 重置按鈕事件
            document.getElementById('resetButton').addEventListener('click', resetAllData);
            
            // 輸入事件 - 更新完成度
            const inputElements = document.querySelectorAll('input, textarea');
            inputElements.forEach(element => {
                element.addEventListener('input', updateCompletionStatus);
                element.addEventListener('input', autoSaveData);
            });
            
            // checkbox事件 - 更新完成度
            const checkboxes = document.querySelectorAll('.phase3-checkbox, .phase4-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateCompletionStatus);
                checkbox.addEventListener('change', autoSaveData);
            });
        }
        
        // 展開/收起階段內容
        function togglePhase(phaseNumber) {
            const header = document.querySelector(`.phase-header[data-phase="${phaseNumber}"]`);
            const content = document.getElementById(`phase-${phaseNumber}`);
            const icon = header.querySelector('.toggle-icon');
            
            // 切換active類
            header.classList.toggle('active');
            content.classList.toggle('active');
            
            // 如果內容是展開狀態，滾動到該區域
            if (content.classList.contains('active')) {
                setTimeout(() => {
                    content.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }
        
        // 更新完成度狀態
        function updateCompletionStatus() {
            // 計算筆記區域
            const textareas = document.querySelectorAll('.notes-area');
            let filledCount = 0;
            
            // 檢查所有筆記區域
            textareas.forEach(textarea => {
                if (textarea.value.trim().length > 0) {
                    filledCount++;
                }
            });
            
            // 計算checkbox區域
            const checkboxes = document.querySelectorAll('.phase3-checkbox, .phase4-checkbox');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    filledCount++;
                }
            });
            
            // 計算階段筆記
            const phaseNotes = document.querySelectorAll('.phase-notes-area');
            phaseNotes.forEach(textarea => {
                if (textarea.value.trim().length > 0) {
                    filledCount++;
                }
            });
            
            // 計算基本信息
            const infoInputs = document.querySelectorAll('#sermonTopic, #targetAudience, #coreTruth, #preacherName, #sermonDate');
            infoInputs.forEach(input => {
                if (input.value && input.value.trim().length > 0) {
                    filledCount++;
                }
            });
            
            // 計算總項目數
            const totalCount = textareas.length + checkboxes.length + phaseNotes.length + infoInputs.length;
            
            // 計算百分比
            const percentage = Math.round((filledCount / totalCount) * 100);
            
            // 更新顯示
            document.getElementById('completionStatus').textContent = `完成度：${percentage}%`;
            
            // 根據完成度改變顏色
            const statusElement = document.getElementById('completionStatus');
            if (percentage < 30) {
                statusElement.style.color = '#e74c3c';
            } else if (percentage < 70) {
                statusElement.style.color = '#f39c12';
            } else {
                statusElement.style.color = '#27ae60';
            }
        }
        
        // 保存所有數據到本地存儲
        function saveAllData() {
            const data = collectFormData();
            
            // 保存到本地存儲
            localStorage.setItem('sermonChecklistData', JSON.stringify(data));
            
            // 顯示保存成功提示
            showNotification('內容已保存到瀏覽器！', 'success');
        }
        
        // 自動保存數據
        let autoSaveTimeout;
        function autoSaveData() {
            // 清除之前的計時器
            clearTimeout(autoSaveTimeout);
            
            // 顯示自動保存指示器
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            
            // 設置新的計時器
            autoSaveTimeout = setTimeout(() => {
                const data = collectFormData();
                localStorage.setItem('sermonChecklistData', JSON.stringify(data));
                
                // 隱藏指示器
                indicator.classList.remove('show');
            }, 2000); // 2秒後自動保存
        }
        
        // 收集表單數據
        function collectFormData() {
            const data = {
                sermonTopic: document.getElementById('sermonTopic').value,
                targetAudience: document.getElementById('targetAudience').value,
                coreTruth: document.getElementById('coreTruth').value,
                preacherName: document.getElementById('preacherName').value,
                sermonDate: document.getElementById('sermonDate').value,
                notes: [],
                phase3: {
                    check11: document.getElementById('check11').checked,
                    check12: document.getElementById('check12').checked,
                    check13: document.getElementById('check13').checked,
                    check14: document.getElementById('check14').checked,
                    phaseNotes: document.getElementById('phase3-notes').value
                },
                phase4: {
                    check15: document.getElementById('check15').checked,
                    check16: document.getElementById('check16').checked,
                    check17: document.getElementById('check17').checked,
                    check18: document.getElementById('check18').checked,
                    phaseNotes: document.getElementById('phase4-notes').value
                }
            };
            
            // 收集所有筆記（第一、二階段）
            const noteTextareas = document.querySelectorAll('.notes-area');
            noteTextareas.forEach((textarea, index) => {
                data.notes.push({
                    id: index + 1,
                    value: textarea.value
                });
            });
            
            return data;
        }
        
        // 顯示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('saveNotification');
            notification.querySelector('span').textContent = message;
            
            // 根據類型設置顏色
            if (type === 'success') {
                notification.style.backgroundColor = '#27ae60';
            } else if (type === 'info') {
                notification.style.backgroundColor = '#3498db';
            } else if (type === 'warning') {
                notification.style.backgroundColor = '#f39c12';
            }
            
            // 顯示通知
            notification.classList.add('show');
            
            // 3秒後自動隱藏
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // 匯出為Word文件（方便列印的兩欄格式）
        function exportToWord() {
            // 收集所有數據
            const data = collectFormData();
            
            // 構建Word文檔內容（兩欄格式，方便列印和手寫）
            let wordContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>講道準備檢核表 - ${data.sermonTopic || '未命名'}</title>
                <style>
                    @page {
                        size: A4;
                        margin: 2cm;
                    }
                    
                    body {
                        font-family: "Microsoft JhengHei", "微軟正黑體", sans-serif;
                        line-height: 1.6;
                        margin: 0;
                        padding: 0;
                        color: #333;
                    }
                    
                    .container {
                        display: flex;
                        flex-wrap: wrap;
                        width: 100%;
                    }
                    
                    .header-section {
                        width: 100%;
                        background-color: #2c3e50;
                        color: white;
                        padding: 20px;
                        text-align: center;
                        margin-bottom: 30px;
                        border-radius: 5px;
                    }
                    
                    .header-section h1 {
                        margin: 0 0 10px 0;
                        font-size: 24px;
                    }
                    
                    .info-section {
                        width: 100%;
                        background-color: #f8f9fa;
                        padding: 20px;
                        margin-bottom: 30px;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        display: flex;
                        flex-wrap: wrap;
                        justify-content: space-between;
                    }
                    
                    .info-item {
                        flex: 1;
                        min-width: 200px;
                        margin: 5px 10px;
                    }
                    
                    .info-item strong {
                        color: #2c3e50;
                    }
                    
                    .two-column {
                        display: flex;
                        width: 100%;
                        margin-bottom: 20px;
                    }
                    
                    .column {
                        flex: 1;
                        padding: 10px;
                    }
                    
                    .column-left {
                        border-right: 1px dashed #ddd;
                    }
                    
                    .phase-title {
                        background-color: #2c3e50;
                        color: white;
                        padding: 10px 15px;
                        font-weight: bold;
                        margin: 20px 0 10px 0;
                        border-radius: 3px;
                        page-break-inside: avoid;
                    }
                    
                    .question-block {
                        margin-bottom: 20px;
                        page-break-inside: avoid;
                    }
                    
                    .question-number {
                        font-weight: bold;
                        color: #e74c3c;
                        margin-right: 5px;
                    }
                    
                    .question-text {
                        font-weight: bold;
                        color: #2c3e50;
                        margin-bottom: 5px;
                    }
                    
                    .answer-area {
                        min-height: 80px;
                        border-bottom: 1px dashed #ccc;
                        margin-top: 10px;
                    }
                    
                    .checkbox-section {
                        margin-bottom: 25px;
                        page-break-inside: avoid;
                    }
                    
                    .checkbox-item {
                        margin-bottom: 12px;
                        padding-left: 25px;
                        position: relative;
                    }
                    
                    .checkbox-item:before {
                        content: "□";
                        position: absolute;
                        left: 0;
                        top: 0;
                        font-size: 18px;
                    }
                    
                    .checkbox-item.checked:before {
                        content: "✓";
                        font-weight: bold;
                    }
                    
                    .phase-notes {
                        background-color: #f0f8ff;
                        padding: 15px;
                        border-left: 4px solid #3498db;
                        margin-top: 15px;
                        margin-bottom: 25px;
                        border-radius: 0 5px 5px 0;
                    }
                    
                    .phase-notes strong {
                        display: block;
                        margin-bottom: 8px;
                        color: #2c3e50;
                    }
                    
                    .prayer-section {
                        width: 100%;
                        background-color: #e8f4fc;
                        padding: 20px;
                        margin-top: 30px;
                        border-left: 5px solid #3498db;
                        page-break-before: always;
                    }
                    
                    .prayer-section h3 {
                        color: #2c3e50;
                        margin-top: 0;
                    }
                    
                    .footer {
                        width: 100%;
                        text-align: center;
                        margin-top: 40px;
                        color: #7f8c8d;
                        font-size: 14px;
                        border-top: 1px solid #eee;
                        padding-top: 20px;
                    }
                    
                    .print-date {
                        font-size: 12px;
                        color: #95a5a6;
                        text-align: right;
                        margin-bottom: 10px;
                    }
                    
                    /* 列印樣式 */
                    @media print {
                        .header-section {
                            background-color: #2c3e50 !important;
                            -webkit-print-color-adjust: exact;
                            print-color-adjust: exact;
                        }
                        
                        .phase-title {
                            background-color: #2c3e50 !important;
                            -webkit-print-color-adjust: exact;
                            print-color-adjust: exact;
                        }
                        
                        .two-column {
                            page-break-inside: avoid;
                        }
                        
                        .question-block {
                            page-break-inside: avoid;
                        }
                        
                        .checkbox-section {
                            page-break-inside: avoid;
                        }
                    }
                </style>
            </head>
            <body>
                <div class="header-section">
                    <h1>講道準備檢核表</h1>
                    <p>「按著正意分解真理的道」（提後2:15）</p>
                </div>
                
                <div class="print-date">列印時間：${new Date().toLocaleString('zh-TW')}</div>
                
                <div class="info-section">
                    <div class="info-item"><strong>講道主題/經文：</strong> ${data.sermonTopic || '未填寫'}</div>
                    <div class="info-item"><strong>講員姓名：</strong> ${data.preacherName || '未填寫'}</div>
                    <div class="info-item"><strong>講道日期：</strong> ${data.sermonDate || '未填寫'}</div>
                    <div class="info-item"><strong>目標會眾：</strong> ${data.targetAudience || '北宣主日'}</div>
                    <div class="info-item"><strong>核心真理：</strong> ${data.coreTruth || '未填寫'}</div>
                </div>`;
            
            // 定義階段標題
            const phaseTitles = [
                "第一階段：扎根聖道——以經解經的嚴謹功夫",
                "第二階段：建造階梯——聽眾心智的認知設計",
                "第三階段：點燃心靈——多感官與情感的觸動",
                "第四階段：倚靠聖靈——內化與禱告的預備"
            ];
            
            // 定義問題文本
            const questions = [
                "上下文檢視：我是否仔細研讀了這段經文的文學上下文（章節脈絡）與歷史文化背景？它如何融入全書主題？",
                "以經解經：針對關鍵詞或概念，我是否使用了其他經文來解釋，而非僅靠個人見解？",
                "基督中心：這段經文如何指向或見證基督？與福音的核心有何關聯？",
                "核心教義提煉：這段經文清晰傳達的一個主要真理是什麼？它屬於哪個基本教義範疇？",
                "生活處境辨認：經文揭示的人性光景、需要或問題，與當代會眾的生命處境有何共通之處？",
                "開場：從「他們的世界」開始：我的開場是否從一個會眾共鳴的故事、文化現象或普遍困惑切入？",
                "結構組塊化（3點為宜）：我將信息分成幾個清晰、易記的模組？",
                "漸進式啟示：每個部分是否遵循「展示經文 → 解釋真意 → 今日應用」的邏輯？",
                "認知休息點：我是否在每部分之間，設計了見證故事、簡短影音或反思問題？",
                "強力結尾：呼召與應許：我的結尾是否清晰呼召會眾作出具體回應，並指向神的應許與恩典？"
            ];
            
            // 添加第一階段（問題1-5）
            wordContent += `<div class="phase-title">${phaseTitles[0]}</div>`;
            
            // 第一階段問題1-5，分成兩欄
            wordContent += '<div class="two-column">';
            wordContent += '<div class="column column-left">';
            
            // 左欄：問題1-3
            for (let i = 0; i < 3; i++) {
                wordContent += `
                <div class="question-block">
                    <div class="question-text"><span class="question-number">${i+1}.</span> ${questions[i]}</div>
                    <div class="answer-area">${data.notes[i] ? data.notes[i].value.replace(/\n/g, '<br>') : ''}</div>
                </div>`;
            }
            
            wordContent += '</div><div class="column">';
            
            // 右欄：問題4-5
            for (let i = 3; i < 5; i++) {
                wordContent += `
                <div class="question-block">
                    <div class="question-text"><span class="question-number">${i+1}.</span> ${questions[i]}</div>
                    <div class="answer-area">${data.notes[i] ? data.notes[i].value.replace(/\n/g, '<br>') : ''}</div>
                </div>`;
            }
            
            wordContent += '</div></div>';
            
            // 添加第二階段（問題6-10）
            wordContent += `<div class="phase-title">${phaseTitles[1]}</div>`;
            
            wordContent += '<div class="two-column">';
            wordContent += '<div class="column column-left">';
            
            // 左欄：問題6-8
            for (let i = 5; i < 8; i++) {
                wordContent += `
                <div class="question-block">
                    <div class="question-text"><span class="question-number">${i+1}.</span> ${questions[i]}</div>
                    <div class="answer-area">${data.notes[i] ? data.notes[i].value.replace(/\n/g, '<br>') : ''}</div>
                </div>`;
            }
            
            wordContent += '</div><div class="column">';
            
            // 右欄：問題9-10
            for (let i = 8; i < 10; i++) {
                wordContent += `
                <div class="question-block">
                    <div class="question-text"><span class="question-number">${i+1}.</span> ${questions[i]}</div>
                    <div class="answer-area">${data.notes[i] ? data.notes[i].value.replace(/\n/g, '<br>') : ''}</div>
                </div>`;
            }
            
            wordContent += '</div></div>';
            
            // 添加第三階段（checkbox項目）
            wordContent += `<div class="phase-title">${phaseTitles[2]}</div>`;
            wordContent += '<div class="checkbox-section">';
            
            // 第三階段項目
            const phase3Questions = [
                "11. 聖經比喻現代化：我是否找到一個當代類比，來闡明經文中的古老比喻或概念？",
                "12. 視覺與多媒體：我使用的視覺輔助是否能強化真理印象，而非分散注意力？",
                "13. 互動與體驗設計：我是否設計了簡單的會眾參與方式？",
                "14. 情感真實性：我分享的見證或應用，是否發自內心，並能真誠地傳遞對神恩典的敬畏、喜樂或盼望？"
            ];
            
            const phase3Keys = ['check11', 'check12', 'check13', 'check14'];
            for (let i = 0; i < phase3Questions.length; i++) {
                const isChecked = data.phase3[phase3Keys[i]];
                wordContent += `
                <div class="checkbox-item ${isChecked ? 'checked' : ''}">
                    ${phase3Questions[i]}
                </div>`;
            }
            
            // 添加第三階段筆記
            if (data.phase3.phaseNotes) {
                wordContent += `
                <div class="phase-notes">
                    <strong>第三階段筆記：</strong>
                    ${data.phase3.phaseNotes.replace(/\n/g, '<br>')}
                </div>`;
            }
            
            wordContent += '</div>';
            
            // 添加第四階段（checkbox項目）
            wordContent += `<div class="phase-title">${phaseTitles[3]}</div>`;
            wordContent += '<div class="checkbox-section">';
            
            // 第四階段項目（修正後的順序）
            const phase4Questions = [
                "15. 信息已內化為生命嗎？：這篇道的信息是否先對我自己說話？我能否不看講稿，自然講述核心內容？",
                "16. 為會眾提名禱告：我是否已為具體的會眾群體和他們可能的反應禱告？",
                "17. 恩典導向：我的講道整體是傳遞「神為你成就了什麼」的福音恩典，還是僅僅停留在「你當做什麼」的道德規條？",
                "18. 聖靈空間：我是否在講章中預留了空間，讓聖靈在現場自由運行與引導？"
            ];
            
            const phase4Keys = ['check15', 'check16', 'check17', 'check18'];
            for (let i = 0; i < phase4Questions.length; i++) {
                const isChecked = data.phase4[phase4Keys[i]];
                wordContent += `
                <div class="checkbox-item ${isChecked ? 'checked' : ''}">
                    ${phase4Questions[i]}
                </div>`;
            }
            
            // 添加第四階段筆記
            if (data.phase4.phaseNotes) {
                wordContent += `
                <div class="phase-notes">
                    <strong>第四階段筆記：</strong>
                    ${data.phase4.phaseNotes.replace(/\n/g, '<br>')}
                </div>`;
            }
            
            wordContent += '</div>';
            
            // 添加禱告部分
            wordContent += `
                <div class="prayer-section">
                    <h3>最後的禱告檢視</h3>
                    <p>「主啊，這篇道：</p>
                    <ul>
                        <li>是否<strong>忠於你的話語</strong>？（第一階段）</li>
                        <li>是否<strong>顧念羊群的需要與理解</strong>？（第二、三階段）</li>
                        <li>是否<strong>倚靠並榮耀你的靈</strong>？（第四階段）</li>
                    </ul>
                    <p>願我不是單傳遞知識，而是<strong>見證你的生命</strong>；不只建造頭腦，更是<strong>觸動心靈，喚醒意志</strong>。奉主耶穌的名求，阿們。」</p>
                </div>
                
                <div class="footer">
                    <p>講道準備檢核表<br>
                    匯出時間：${new Date().toLocaleString('zh-TW')}</p>
                </div>
            </body>
            </html>`;
            
            // 創建Blob對象
            const blob = new Blob(['\ufeff', wordContent], {
                type: 'application/msword'
            });
            
            // 創建下載連結
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            // 生成文件名
            const fileName = `北宣證道準備檢核表_${data.preacherName || '講員'}_${data.sermonDate || new Date().toISOString().slice(0, 10)}.doc`;
            a.download = fileName;
            
            // 觸發下載
            document.body.appendChild(a);
            a.click();
            
            // 清理
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            showNotification('Word文件已開始下載！', 'success');
        }
        
        // 重置所有數據
        function resetAllData() {
            if (confirm('確定要重置所有內容嗎？這將清除所有已填寫的資料。')) {
                // 清除表單
                document.getElementById('sermonTopic').value = '';
                document.getElementById('targetAudience').value = '北宣主日';
                document.getElementById('coreTruth').value = '';
                document.getElementById('preacherName').value = '';
                const today = new Date();
                const todayFormatted = today.toISOString().split('T')[0];
                document.getElementById('sermonDate').value = todayFormatted;
                
                // 清除所有筆記（第一、二階段）
                const noteTextareas = document.querySelectorAll('.notes-area');
                noteTextareas.forEach(textarea => {
                    textarea.value = '';
                });
                
                // 清除所有checkbox
                const checkboxes = document.querySelectorAll('.phase3-checkbox, .phase4-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // 清除階段筆記
                document.getElementById('phase3-notes').value = '';
                document.getElementById('phase4-notes').value = '';
                
                // 清除本地存儲
                localStorage.removeItem('sermonChecklistData');
                
                // 更新完成度
                updateCompletionStatus();
                
                showNotification('所有內容已重置！', 'info');
            }
        }
        
        // 頁面加載時檢查是否有保存的數據
        function loadSavedData() {
            const savedData = localStorage.getItem('sermonChecklistData');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // 載入基本信息
                    document.getElementById('sermonTopic').value = data.sermonTopic || '';
                    document.getElementById('targetAudience').value = data.targetAudience || '北宣主日';
                    document.getElementById('coreTruth').value = data.coreTruth || '';
                    document.getElementById('preacherName').value = data.preacherName || '';
                    document.getElementById('sermonDate').value = data.sermonDate || '';
                    
                    // 載入筆記（第一、二階段）
                    if (data.notes && data.notes.length > 0) {
                        const noteTextareas = document.querySelectorAll('.notes-area');
                        data.notes.forEach((note, index) => {
                            if (noteTextareas[index]) {
                                noteTextareas[index].value = note.value || '';
                            }
                        });
                    }
                    
                    // 載入第三階段數據
                    if (data.phase3) {
                        document.getElementById('check11').checked = data.phase3.check11 || false;
                        document.getElementById('check12').checked = data.phase3.check12 || false;
                        document.getElementById('check13').checked = data.phase3.check13 || false;
                        document.getElementById('check14').checked = data.phase3.check14 || false;
                        document.getElementById('phase3-notes').value = data.phase3.phaseNotes || '';
                    }
                    
                    // 載入第四階段數據（處理舊版本和新版本）
                    if (data.phase4) {
                        // 舊版本兼容：如果存在舊的check18和check19，映射到新的check17和check18
                        document.getElementById('check15').checked = data.phase4.check15 || false;
                        document.getElementById('check16').checked = data.phase4.check16 || false;
                        
                        // 嘗試新版本
                        if (data.phase4.check17 !== undefined) {
                            document.getElementById('check17').checked = data.phase4.check17 || false;
                        } else if (data.phase4.check18 !== undefined) {
                            // 舊版本：舊的check18對應新的check17（恩典導向）
                            document.getElementById('check17').checked = data.phase4.check18 || false;
                        }
                        
                        if (data.phase4.check18 !== undefined) {
                            document.getElementById('check18').checked = data.phase4.check18 || false;
                        } else if (data.phase4.check19 !== undefined) {
                            // 舊版本：舊的check19對應新的check18（聖靈空間）
                            document.getElementById('check18').checked = data.phase4.check19 || false;
                        }
                        
                        document.getElementById('phase4-notes').value = data.phase4.phaseNotes || '';
                    }
                    
                    // 更新完成度
                    updateCompletionStatus();
                } catch (e) {
                    console.error('載入保存數據時出錯:', e);
                }
            }
        }
    </script>
</body>
</html>
